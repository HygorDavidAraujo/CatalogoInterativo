<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administração - Davini Vinhos Finos</title>
    <link rel="icon" type="image/svg+xml" href="images/favicon.svg">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/admin.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="admin-body">
    <!-- Header Admin -->
    <header class="admin-header">
        <div class="container">
            <h1><i class="fas fa-wine-bottle"></i> Painel Administrativo</h1>
            <div class="admin-nav">
                <a href="clientes.html" class="btn btn-secondary">
                    <i class="fas fa-users"></i> Gerenciar Clientes
                </a>
                <a href="index.html" class="btn-voltar">
                    <i class="fas fa-home"></i> Ver Site
                </a>
            </div>
        </div>
    </header>

    <!-- Admin Content -->
    <main class="admin-main">
        <div class="container">
            <!-- Configurações de Contato -->
            <div class="admin-card admin-card-full">
                <h2><i class="fas fa-cog"></i> Configurações do Site</h2>
                <form id="form-configuracoes" class="form-config">
                    <h3>Informações do Site</h3>
                    <div class="form-group">
                        <label for="config-nome-site">Nome do Site</label>
                        <input type="text" id="config-nome-site" name="nome_site" placeholder="Davini Vinhos Finos">
                    </div>
                    <div class="form-group">
                        <label for="config-titulo">Título Principal</label>
                        <input type="text" id="config-titulo" name="titulo" placeholder="Descubra Vinhos Excepcionais">
                    </div>
                    <div class="form-group">
                        <label for="config-descricao">Descrição</label>
                        <input type="text" id="config-descricao" name="descricao" placeholder="Uma seleção especial dos melhores vinhos para você">
                    </div>

                    <h3>Informações de Contato</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="config-telefone">Telefone</label>
                            <input type="text" id="config-telefone" name="telefone" placeholder="(54) 99999-9999">
                        </div>
                        <div class="form-group">
                            <label for="config-email">E-mail</label>
                            <input type="email" id="config-email" name="email" placeholder="contato@davinivinhos.com.br">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="config-endereco">Endereço</label>
                        <input type="text" id="config-endereco" name="endereco" placeholder="Jolimont, RS">
                    </div>

                    <h3>Redes Sociais</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="config-instagram">Instagram (URL completa)</label>
                            <input type="url" id="config-instagram" name="instagram" placeholder="https://instagram.com/davinivinhos">
                        </div>
                        <div class="form-group">
                            <label for="config-facebook">Facebook (URL completa)</label>
                            <input type="url" id="config-facebook" name="facebook" placeholder="https://facebook.com/davinivinhos">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="config-whatsapp">WhatsApp (número com código do país)</label>
                        <input type="text" id="config-whatsapp" name="whatsapp" placeholder="5554999999999">
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Salvar Configurações
                        </button>
                    </div>
                </form>
            </div>

            <div class="admin-grid">
                <!-- Formulário de Cadastro -->
                <div class="admin-card">
                    <h2><i class="fas fa-plus-circle"></i> Cadastrar Novo Vinho</h2>
                    <form id="form-vinho" class="form-vinho">
                        <div class="form-group">
                            <label for="nome">Nome do Vinho *</label>
                            <input type="text" id="nome" name="nome" required>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="tipo">Tipo *</label>
                                <select id="tipo" name="tipo" required>
                                    <option value="">Selecione...</option>
                                    <optgroup label="Vinhos">
                                        <option value="tinto">Tinto</option>
                                        <option value="branco">Branco</option>
                                        <option value="rose">Rosé</option>
                                        <option value="espumante">Espumante</option>
                                    </optgroup>
                                    <optgroup label="Suco Integral">
                                        <option value="suco_integral_tinto">Suco Integral - Tinto</option>
                                        <option value="suco_integral_branco">Suco Integral - Branco</option>
                                    </optgroup>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="uva">Tipo de Uva *</label>
                                <input type="text" id="uva" name="uva" required placeholder="Ex: Merlot, Cabernet">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="pais-origem">País de Origem</label>
                                <select id="pais-origem" name="pais_origem" data-flag-base="https://flagcdn.com/w40/">
                                    <option value="" data-code="" data-flag="">Selecione o país</option>
                                    <option value="Brasil" data-code="BR" data-flag="https://flagcdn.com/w80/br.png">Brasil</option>
                                    <option value="Argentina" data-code="AR" data-flag="https://flagcdn.com/w80/ar.png">Argentina</option>
                                    <option value="Chile" data-code="CL" data-flag="https://flagcdn.com/w80/cl.png">Chile</option>
                                    <option value="Uruguai" data-code="UY" data-flag="https://flagcdn.com/w80/uy.png">Uruguai</option>
                                    <option value="Estados Unidos" data-code="US" data-flag="https://flagcdn.com/w80/us.png">Estados Unidos</option>
                                    <option value="Portugal" data-code="PT" data-flag="https://flagcdn.com/w80/pt.png">Portugal</option>
                                    <option value="Espanha" data-code="ES" data-flag="https://flagcdn.com/w80/es.png">Espanha</option>
                                    <option value="França" data-code="FR" data-flag="https://flagcdn.com/w80/fr.png">França</option>
                                    <option value="Itália" data-code="IT" data-flag="https://flagcdn.com/w80/it.png">Itália</option>
                                    <option value="Outro" data-code="" data-flag="">Outro (preencher manualmente)</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="pais-codigo">Código ISO do País</label>
                                <input type="text" id="pais-codigo" name="pais_codigo" placeholder="BR" maxlength="2" style="text-transform: uppercase;" readonly>
                                <input type="hidden" id="bandeira-url" name="bandeira_url">
                                <div class="flag-preview" id="flag-preview" style="display: none;">
                                    <img id="flag-img" alt="Bandeira" width="32" height="20">
                                    <span id="flag-label"></span>
                                </div>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="ano">Ano de Safra *</label>
                                <input type="number" id="ano" name="ano" required min="1900" max="2025" placeholder="Ex: 2020">
                            </div>

                            <div class="form-group">
                                <label for="guarda">Tempo de Guarda</label>
                                <input type="text" id="guarda" name="guarda" placeholder="Ex: 5 a 10 anos">
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="harmonizacao">Harmonização</label>
                            <textarea id="harmonizacao" name="harmonizacao" rows="3" placeholder="Ex: Carnes vermelhas, massas, queijos..."></textarea>
                        </div>

                        <div class="form-group">
                            <label for="descricao">Sobre o Vinho</label>
                            <textarea id="descricao" name="descricao" rows="4" placeholder="Descrição completa do vinho..."></textarea>
                        </div>

                        <div class="form-group">
                            <label for="preco">Preço (R$) *</label>
                            <input type="number" id="preco" name="preco" required min="0" step="0.01" placeholder="Ex: 89.90">
                        </div>

                        <div class="form-group">
                            <label for="imagem">Imagem do Vinho *</label>
                            <div class="upload-container">
                                <input type="file" id="imagem" name="imagem" accept="image/*" class="file-input">
                                <div class="upload-preview" id="upload-preview">
                                    <i class="fas fa-image"></i>
                                    <p>Clique ou arraste uma imagem aqui</p>
                                    <span class="upload-info">Formatos: JPG, PNG, GIF (Max: 5MB)</span>
                                </div>
                                <img id="preview-imagem" class="preview-img" style="display: none;">
                            </div>
                            <small>Ou use uma URL externa:</small>
                            <input type="text" id="imagem-url" name="imagemUrl" placeholder="https://exemplo.com/imagem.jpg">
                            <small class="text-info" style="display: block; margin-top: 5px; color: #0066cc;">
                                <i class="fas fa-info-circle"></i> Se houver limite de uploads, use uma URL externa (recomendado: imgur.com, imgbb.com)
                            </small>
                        </div>

                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="ativo" name="ativo" checked>
                                <span>✓ Mostrar este vinho no site</span>
                            </label>
                            <small style="display: block; margin-top: 5px; color: #666;">Desmarque para ocultar temporariamente sem excluir</small>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Salvar Vinho
                            </button>
                            <button type="button" class="btn btn-secondary" id="btn-cancelar">
                                <i class="fas fa-times"></i> Cancelar
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Lista de Vinhos Cadastrados -->
                <div class="admin-card">
                    <h2><i class="fas fa-list"></i> Vinhos Cadastrados</h2>
                    
                    <!-- Filtros de Busca -->
                    <div class="filtros-admin">
                        <div class="busca-admin">
                            <i class="fas fa-search"></i>
                            <input type="text" id="busca-admin" placeholder="Buscar por nome ou tipo de uva..." class="input-busca-admin">
                        </div>
                        <div class="filtro-tipo-admin">
                            <select id="filtro-tipo-admin" class="select-filtro-admin">
                                <option value="todos">Todos os tipos</option>
                                <option value="tinto">Tintos</option>
                                <option value="branco">Brancos</option>
                                <option value="rose">Rosés</option>
                                <option value="espumante">Espumantes</option>
                                <option value="suco_integral">Suco Integral</option>
                            </select>
                        </div>
                    </div>
                    
                    <div id="lista-vinhos-admin" class="lista-vinhos-admin">
                        <!-- Lista será carregada via JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Modal de Confirmação -->
    <div id="modal-confirmar" class="modal">
        <div class="modal-content modal-small">
            <h3>Confirmar Exclusão</h3>
            <p>Tem certeza que deseja excluir este vinho?</p>
            <div class="modal-actions">
                <button class="btn btn-danger" id="btn-confirmar-delete">Sim, Excluir</button>
                <button class="btn btn-secondary" id="btn-cancelar-delete">Cancelar</button>
            </div>
        </div>
    </div>

    <script src="js/config.js"></script>
    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/api-admin.js"></script>
    <script>
        // Proteger página admin - executar imediatamente
        (function() {
            console.log('=== VERIFICAÇÃO DE ACESSO ADMIN ===');
            
            // Verificar sessionStorage diretamente
            const usuarioSalvo = sessionStorage.getItem('usuario');
            console.log('SessionStorage usuario:', usuarioSalvo);
            
            if (usuarioSalvo) {
                const usuario = JSON.parse(usuarioSalvo);
                console.log('Usuário parseado:', usuario);
                console.log('isAdmin:', usuario.isAdmin);
                
                if (usuario.isAdmin === true) {
                    console.log('✅ Acesso permitido!');
                    return; // Permitir acesso
                }
            }
            
            // Se chegou aqui, não tem acesso
            console.log('❌ Acesso negado! Redirecionando...');
            alert('Acesso negado! Apenas administradores podem acessar esta página.');
            window.location.href = 'index.html';
        })();
    </script>
</body>
</html>
